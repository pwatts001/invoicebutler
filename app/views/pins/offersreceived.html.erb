<h1>Welcome <%= current_user.user_name %></h1>
<hr style="height: 2px; background-color: grey;"></hr>

<div class="center">
  <%= render 'layouts/supplierdashboardpages' %>
</div>

<br><br>

<% if !@pins.first %>
 <p>You currently have no available offers</p>
<% end %>

<% if @pins.first %>
  <div>
    <p>FatFace have recenlty approved <%= @pinscount %> of your invoice(s) with the option of early payment.</p>
    <p>You will receive the full invoice amount on the invoice due dates or you can select which you'd like to receive early payments on. To do this selcet Accept/Reject options in the table below and press "Submit".</p>
    <p>The new payment amounts are as per the table below. The date on which these would be paid is <%= fulldate(@pins.first.prop_settlement_date) %>.</p>
    <p>This offer will expire on <%= fulldate(@pins.first.offer_expirey_date) %>.</p>
  </div>
  <br>
  <%= form_for @pins.first, html: { multipart: true } do |f| %>
    <table class="table table-hover table-bordered table-striped invtable">
      <thead>
        <tr>
          <th><%= sortable "invoice_number", "Invoice Number" %></th>
          <th><%= sortable "description", "Description" %></th>
          <th><%= sortable "invoice_date", "Invoice Date" %></th>
          <th><%= sortable "due_date", "Due Date" %></th>
          <th><%= sortable "invoice_curr", "Invoice Currency" %></th>
          <th><%= sortable "invoice_amount", "Invoice Amount" %></th>
          <th><%= sortable "status", "Offer Status" %></th>
          <th><%= sortable "prop_settlement_date", "Proposed Settlement Date" %></th>
          <th><%= sortable "offer_amount", "New Offer Amount" %></th>
          <th><%= sortable "saving", "Requested Discount" %></th>
          <th><%= sortable "offer_expirey_date", "Offer Expirey Date" %></th>
          <th>Available Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @pins.each do |pin| %>
          <tr>
            <th><%= pin.invoice_number %></th>
            <th><%= pin.description %></th> 
            <th><%= date(pin.invoice_date) %></th>
            <th><%= date(pin.due_date) %></th>
            <th><%= pin.invoice_curr %></th>
            <th><%= currency(pin.invoice_amount) %></th>
            <th><%= pin.status %></th>
            <th><%= date(pin.prop_settlement_date) %></th>
            <th><%= currency(pin.offer_amount) %></th>
            <th><%= currency(pin.saving) %></th>
            <th><%= date(pin.offer_expirey_date) %></th>
            <th> <%= render :partial => 'accept_reject_form', :locals => {:pin => pin} %> </th>
          </tr>
        <% end %>  
      </tbody>
    </table>

    <div class="pull-right">
      <button type="button" id="markAllAccepted" data-complete-text="finished!" class="btn btn-success" autocomplete="off">
        Mark all
      </button>
      <button type="button" id="markAllRejected" data-complete-text="finished!" class="btn btn-primary" autocomplete="off">
        Mark all
      </button>
    </div>
    <br><br>
    <div>
      <div style='float: left'>Total selected for early payments:</div>
      <div id="totalEarlyPayment" ><%= @totalEarlyPayment %></div>
    </div>
    <br><br>
    <!-- Button trigger modal -->
    <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
      Submit
    </button>

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document" style="left: 0px">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">Confirmation</h4>
          </div>
          <div class="modal-body">
            By confirming you agree to the new payment terms etc etc
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Back</button>
  <%= f.submit "Confirm", class: "btn btn-primary" %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
<% end %>

<br><br>


       
<script>
  $('#markAllAccepted').on('click', function () {
    $(Accept).button('toggle')
  })
  $('#markAllRejected').on('click', function () {
    $(Reject).button('toggle')
  })

$('input[type=radio]').change( function() {
   calculateTotalEarlyPayment() 
});

var list = document.getElementById('totalEarlyPayment');
var a = 1;
      function calculateTotalEarlyPayment(){
              // fetch all accepted and calculate new total here
              list.removeChild(list.firstChild);
              var li = a;
              var z = document.createElement('div');
              z.innerHTML = li;
              document.body.appendChild(z);
              list.appendChild(z);
              a++;
      }    
</script>





